function Check-ADFeature {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory, ValueFromPipeline)]
        [ValidateNotNullOrEmpty()]
        [string[]]$ComputerNames = 'Sprague-DC1',

        [Parameter(Mandatory)]
        [ValidateNotNull()]
        [pscredential]$Credential,

        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$FeatureName = 'AD-Domain-Services'
    )

    foreach ($Computer in $ComputerNames) {
        Begin {
            $Session = New-PSSession -ComputerName $Computer -Credential $Credential -ErrorAction Stop
        }

        Process {
            $ServicesScriptBlock = {
                param($FeatureName)
                try {
                    $adFeature = Get-WindowsFeature -Name $FeatureName -ErrorAction Stop
                } catch {
                    Write-Error "Error checking $Computer. Details: $($_.Exception.Message)"
                    return
                }

                if ($adFeature.InstallState -eq 'Installed') {
                    Write-Output "Active Directory Domain Services is installed on $Computer."
                } else {
                    Write-Output "Active Directory Domain Services is NOT installed on $Computer."   
                }
            } 
            #Execute the script block on the remote computer
            Invoke-Command -Session $Session -ScriptBlock $ServicesScriptBlock -ArgumentList $FeatureName
        }

        End {
            Remove-PSSession -Session $Session
        }
    }
}
#END OF SCRIPT 
