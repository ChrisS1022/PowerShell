function Check-ADFeature {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory, ValueFromPipelineByPropertyName)]
        [ValidateNotNullOrEmpty()]
        [string[]]$ComputerName = 'Sprague-DC1',

        [Parameter(Mandatory)]
        [ValidateNotNull()]
        [pscredential]$Credential,

        [Parameter(Mandatory, ValueFromPipelineByPropertyName)]
        [ValidateNotNullOrEmpty()]
        [string[]]$FeatureName = 'AD-Domain-Services'
    )

    foreach ($Computer in $ComputerName) {
        try {
            $Session = New-PSSession -ComputerName $Computer -Credential $Credential -ErrorAction Stop
        } catch {
            Write-Error "Error connecting to $Computer. Details: $($_.Exception.Message)"
            continue
        }

        foreach ($Feature in $FeatureName) {
            $ServicesScriptBlock = {
                param($Feature)
                try {
                    $adFeature = Get-WindowsFeature -Name $Feature -ErrorAction Stop
                } catch {
                    Write-Error "Error checking $Computer. Details: $($_.Exception.Message)"
                    return
                }

                if ($adFeature.InstallState -eq 'Installed') {
                    Write-Output "$Feature is installed on $Computer."
                } else {
                    Write-Output "$Feature is NOT installed on $Computer."   
                }
            } 

            Invoke-Command -Session $Session -ScriptBlock $ServicesScriptBlock -ArgumentList $Feature
        }

        Remove-PSSession -Session $Session
    }
}
